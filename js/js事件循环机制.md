# js事件循环机制

# 线程

## 1.js线程

JavaScript 是一门单线程语言（Web-Worker）。

**主线程**：也就是 js 引擎执行的线程，这个线程只有一个，页面渲染、函数处理都在这个主线程上执行。

**工作线程**：也称幕后线程，这个线程可能存在于浏览器或js引擎内，与主线程是分开的，处理文件读取、网络请求等异步事件。

## 2.执行栈，任务队列

- 同步任务执行时送入主线程，形成执行栈（调用栈）
- web api执行异步代码时，处理完异步代码后将异步的回调函数推入任务队列（即异步代码运行环境）
- 当主线程的栈中执行栈所有同步代码执行完毕后，调用栈为空，浏览器会将任务队列的异步任务依次压入栈中z执行（先进先出），当调用栈为空时，循环检查任务队列是否有异步任务需要执行。

## 3.宏任务macrotask，微任务microtask

![image](LsLXfcBrmTJ_R-ZIsLLxRoQfCiTrzGW1Hxpw5_ZvbEk.png)

## 微任务在任务队列的优先级大于宏队列，在宏队列前执行

2\. promise函数内部是同步处理的，不会放到队列中，放入队列中的是它的then或catch回调

3\. promise的then返回的还是promise，

## 
